<!DOCTYPE html>
<!--
A basic website that plays youtube videos that can be controlled by a
IR remote. Created for COMP3601 Project
-->


<html lang="en">
<head>
  <title>YouTube Player</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="mySidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeMenu()">×</a>
    <li><a href="index.html">Home</a></li>
    <li><div class="active"></div>
    <a href="youtube.html" style="color:white; clear:left; padding:20px">Youtube Player</a></li>
    <li><a href="soundcloud.html">SoundCloud Player</a></li>
  </div>
  
  <div id="main">

    <div class = "menu">
      <button class="openbtn" onclick="openMenu()">☰</button>
    </div>

    <div class = "header">
      <img src = "youtubeicon.png" width ="125px">
      <br>
      <img src="youtube.png">
    </div>

    <div class = content>
      <h3> Enter a YouTube URL to add a new song: </h3>
      <input type="text" id="nextSong">
      <br>
      <br>
      <button class ="button button2" onclick= "addNewSong(); document.getElementById('nextSong').value = ''"><b> +  ADD NEW SONG </b> </button>
      <br>
      <!-- Displays songs in current playlist -->
      <table style="width:100%;"> 
        <tr style="width:100%;">
            <td style="width:21%;"></td>
            <td style="width:58%; text-align: left;  padding:1%">
                <h3>Songs</h3>
                <div class="underline"></div> 
                <p id="song"></p>

            </td>
            <td style="width:21%;">

            </td>
        </tr>
      </table>

      <!-- Based on code: https://developers.google.com/youtube/iframe_api_reference-->
      <div id="player"></div>

    </div>
    <div class = "bar">
      <br>
      <table style="width:100%">
        <tr>
          <td style="width:30%; text-align: left;"> 
          </td>
          <td style="width:30%; text-align: center;"> 
            <button class ="button button1" onclick= "getPrevSong()"> <img src="prev.png" width="20"> </button>
            <button class ="button button1" onclick= "playPause()"> <img src="play.png" id = "playPauseButton" width="20"></button>
            <button class ="button button1" onclick= "getNextSong()">  <img src="next.png" width="20"> </button>
          </td>
          <td style="width:30%; text-align: right;"> 
            <div class = "sound">
              <button id = "muteButton" class ="button button1" onclick= "mute()"> <img src="mute.png" width="20"></button>            
              <button class ="button button1" onclick= "volumeDown()"> <img src="volumeDown.png" width="20"> </button>              
              <button class ="button button1" onclick= "volumeUp()"> <img src="volumeUp.png" width="20"></button>
            </div>
          </td>
        </tr>
      </table>
      <br>
    </div>
  </div>
</body>

<script>
  var songs = ["_6pyzdiG1g0"];
  var index = 0;
  var play = false; 
  var open = false; 
  var muted = false; 

  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
    
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  var player;
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '720',
      width: '1200',
      playerVars: {
        'autoplay': 0,
        'controls': 1,
        'disablekb': 1,
        'fs': 0,
        'loop': 1,
        'modestbranding': 1,
        'rel': 0,
        'showinfo': 0,
        'autohide': 1
      },
      videoId: songs[index],
      events: {
        'onReady': onPlayerReady,
      }
    });
  }

  function onPlayerReady(event) {
    player.seekTo(0, true);
    player.setVolume(30);
    printSongs();
    player.playVideo();
  }


  function printSongs() {
    var txt = "";
    txt += player.getVideoData().title; 
    songNames[index] = txt;
    document.getElementById("song").innerHTML = songNames.join("<br>");
  }

  function addNewSong() {
    var videoId = document.getElementById("nextSong").value;
    if(videoId.includes("www.youtube.com/watch")){
      videoId = videoId.split('=')[1];
      if(videoId.length > 0){
        songs.push(videoId);
        songNames.push(videoId);
        printSongs()
      }
    }
  }


  function getNextSong() {
    printSongs()
    index++;
    index = index % songs.length; 
    var videoId = songs[index];
    player.loadVideoById(videoId);
    if(!play){
      document.getElementById("playPauseButton").src="pause.png";
      play = true; 
    }
  }

  function getPrevSong() {
    printSongs()
    index--;
    index = index % songs.length; 
    var videoId = songs[index];
    player.loadVideoById(videoId);
    if(!play){
      document.getElementById("playPauseButton").src="pause.png";
      play = true; 
    }
  }

  function volumeUp() {
    var volume = player.getVolume();
    volume+=10; 
    if(volume == 10 || muted){
      muted = false; 
      document.getElementById("muteButton").classList.remove('button1Selected');
      player.unMute();
    }
    player.setVolume(volume);
  }

  function volumeDown() {
    var volume = player.getVolume();
    volume-=10; 
    if(volume == 0){
      muted = true; 
      document.getElementById("muteButton").classList.toggle('button1Selected');
    }
    player.setVolume(volume);
  }
    
  function mute() {
    if(!muted){
      player.mute()
      muted = true; 
      document.getElementById("muteButton").classList.toggle('button1Selected');
    } else {
      player.unMute();
      muted = false; 
      document.getElementById("muteButton").classList.remove('button1Selected');
    }        
  }
    
  function playPause() {
    if(play){
      player.pauseVideo();
      document.getElementById("playPauseButton").src="play.png"; 
      play = false;
		} else {
      player.playVideo();
      document.getElementById("playPauseButton").src="pause.png";
      play = true; 
    }
  }
  function openMenu() {
    if(!open){
      document.getElementById("mySidebar").style.width = "300px";
      document.getElementById("main").style.marginLeft = "300px";
      open = true; 
    } else {
      document.getElementById("mySidebar").style.width = "0";
      document.getElementById("main").style.marginLeft= "0";
      open = false; 
    }
  }

  function closeMenu() {
    document.getElementById("mySidebar").style.width = "0";
    document.getElementById("main").style.marginLeft= "0";
    open = false; 
  }      
</script>
</html>

